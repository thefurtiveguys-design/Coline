<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Batterie de Tests Psychologiques | BART ¬∑ SVO ¬∑ RAVEN ¬∑ RME</title>
  <style>
    /* ---------- STYLE SOBRE, LABORATOIRE, SANS EMAJIS ---------- */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    }

    body {
      background: #edf2f7;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 24px 16px;
    }

    .container {
      max-width: 880px;
      width: 100%;
      background: white;
      border-radius: 20px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.05), 0 4px 8px rgba(0,0,0,0.02);
      padding: 36px 32px;
      border: 1px solid #e2e8f0;
    }

    /* en-t√™te neutre */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      border-bottom: 1px solid #dde5ed;
      padding-bottom: 16px;
      margin-bottom: 28px;
    }

    .header h1 {
      font-weight: 500;
      font-size: 1.6rem;
      color: #1a2e40;
      letter-spacing: -0.02em;
    }

    .progress {
      font-size: 0.9rem;
      color: #4a6479;
      background: #e9f0f5;
      padding: 6px 16px;
      border-radius: 40px;
      font-weight: 450;
    }

    /* zone de test */
    .test-area {
      background: #ffffff;
      border-radius: 16px;
      padding: 24px 20px;
      margin-bottom: 30px;
      border: 1px solid #eef3f8;
      box-shadow: inset 0 1px 3px #00000008, 0 2px 4px #00000004;
      min-height: 340px;
    }

    .test-title {
      font-weight: 600;
      font-size: 1.2rem;
      color: #1e3b4f;
      margin-bottom: 24px;
      border-left: 4px solid #3a6f8f;
      padding-left: 16px;
    }

    /* boutons */
    .btn {
      background: white;
      border: 1px solid #b8ccda;
      padding: 12px 28px;
      border-radius: 40px;
      font-size: 0.95rem;
      font-weight: 500;
      color: #1e3b4f;
      transition: 0.1s;
      cursor: pointer;
      box-shadow: 0 2px 2px rgba(0,0,0,0.02);
    }

    .btn:hover {
      background: #f0f5fa;
      border-color: #8aaec2;
    }

    .btn-primary {
      background: #2c5f7a;
      border-color: #1e4559;
      color: white;
    }

    .btn-primary:hover {
      background: #1e4a62;
    }

    .btn-group {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      align-items: center;
      margin-top: 20px;
    }

    /* BART : ballon */
    .balloon-container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .balloon-svg {
      width: 140px;
      height: 160px;
      margin-bottom: 8px;
    }

    .cash-indicator {
      background: #f1f6fa;
      padding: 12px 24px;
      border-radius: 60px;
      font-size: 1.2rem;
      color: #1e3b4f;
      font-weight: 500;
      margin-top: 16px;
    }

    /* SVO */
    .svo-scenario {
      background: #f7fafc;
      padding: 24px;
      border-radius: 16px;
      font-size: 1.1rem;
      color: #1e3b4f;
      margin-bottom: 24px;
      border-left: 4px solid #5e8c9c;
    }

    /* RAVEN : matrice */
    .matrix-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      background: #2a4050;
      padding: 18px;
      border-radius: 20px;
      margin: 24px 0;
    }

    .matrix-cell {
      background: white;
      width: 80px;
      height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8rem;
      border-radius: 12px;
      box-shadow: inset 0 -2px 0 #cbd5e0;
    }

    .raven-choices {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      margin: 24px 0 12px;
    }

    .choice-cell {
      background: #f1f7fc;
      border: 2px solid #dce5ec;
      width: 70px;
      height: 70px;
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.6rem;
      cursor: pointer;
      transition: 0.1s;
    }

    .choice-cell:hover {
      border-color: #2c5f7a;
      background: #e1ecf4;
    }

    /* RME */
    .eyes-stimulus {
      font-size: 4.8rem;
      line-height: 1.2;
      letter-spacing: 4px;
      background: #f2f6fa;
      display: inline-block;
      padding: 16px 32px;
      border-radius: 60px;
      margin: 20px 0;
    }

    .emotion-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
      margin-top: 24px;
    }

    .emotion-item {
      background: #f7fafc;
      border: 1px solid #d8e2eb;
      padding: 16px 12px;
      border-radius: 40px;
      text-align: center;
      font-size: 1rem;
      font-weight: 500;
      color: #1e3b4f;
      cursor: pointer;
    }

    .emotion-item:hover {
      background: #e2ebf3;
      border-color: #3a6f8f;
    }

    /* dashboard lettres */
    .dashboard-letters {
      background: #1a2e40;
      border-radius: 20px;
      padding: 28px 24px;
      margin: 36px 0 20px;
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
      color: white;
    }

    .score-block {
      text-align: center;
    }

    .score-cat {
      font-size: 2.2rem;
      font-weight: 600;
      color: #f5e7c8;
      margin-bottom: 4px;
    }

    .score-val {
      font-size: 2rem;
      font-weight: 700;
      background: #0000001c;
      padding: 8px 18px;
      border-radius: 60px;
    }

    /* admin */
    .admin-panel {
      background: #e9f0f5;
      border-radius: 18px;
      padding: 24px;
      margin-top: 24px;
      border-left: 6px solid #1a2e40;
    }

    .code-input-area {
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
    }

    #secretCode {
      padding: 14px 18px;
      font-size: 1.2rem;
      width: 130px;
      text-align: center;
      border-radius: 40px;
      border: 1px solid #a0bbcc;
      background: white;
      font-weight: 600;
      letter-spacing: 2px;
    }

    .interpretation-box {
      background: #fcfaf0;
      padding: 24px;
      border-radius: 16px;
      margin-top: 24px;
      border: 1px solid #e2dccd;
      color: #1e3b4f;
      line-height: 1.5;
    }

    .hidden {
      display: none;
    }

    hr {
      border: none;
      border-top: 1px solid #dbe2ea;
      margin: 30px 0 20px;
    }

    .footer-note {
      font-size: 0.75rem;
      color: #5e7c8c;
      text-align: center;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- en-t√™te sobre -->
    <div class="header">
      <h1>LABORATOIRE PSYCHOLOGIE</h1>
      <span class="progress" id="progressPhase">phase 1/4</span>
    </div>

    <!-- zone principale qui affiche le test en cours -->
    <div id="testPanel" class="test-area">
      <!-- contenu inject√© dynamiquement -->
    </div>

    <!-- DASHBOARD SCORES (lettres A B C D) -->
    <div class="dashboard-letters" id="scoreDashboard">
      <div class="score-block"><div class="score-cat">A</div><div class="score-val" id="scoreA">0</div></div>
      <div class="score-block"><div class="score-cat">B</div><div class="score-val" id="scoreB">0</div></div>
      <div class="score-block"><div class="score-cat">C</div><div class="score-val" id="scoreC">0</div></div>
      <div class="score-block"><div class="score-cat">D</div><div class="score-val" id="scoreD">0</div></div>
    </div>

    <!-- espace chercheur - code 1983 -->
    <div class="admin-panel">
      <div style="font-weight: 600; color: #1a2e40; margin-bottom: 16px;">‚å®Ô∏è acc√®s chercheur</div>
      <div class="code-input-area">
        <input type="password" id="secretCode" placeholder="code" maxlength="4">
        <button id="unlockBtn" class="btn" style="background:#1a2e40; color:white; border:none;">d√©verrouiller</button>
        <button id="resetBtn" class="btn">r√©initialiser</button>
      </div>
      <div id="adminInterpretation" class="interpretation-box hidden">
        <p id="interpText" style="white-space: pre-line;"></p>
      </div>
    </div>
    <div class="footer-note">
      BART ¬∑ SVO ¬∑ RAVEN ¬∑ RME ‚Äî adaptation pour recherche
    </div>
  </div>

  <script>
    // ------------------------------------------------------------
    //  √âTAT CENTRAL ‚Äì d√©roulement s√©quentiel impos√©
    // ------------------------------------------------------------
    const State = {
      // phase : 0=BART, 1=SVO, 2=RAVEN, 3=RME, 4=termin√©
      phase: 0,
      // BART
      bart: {
        trialCount: 0,          // 0 √† 30
        currentPumps: 0,
        tempMoney: 0,
        explosionPoint: 8,
        pumpsHistory: [],      // nombre de pompes pour ballons collect√©s
        balloonsDone: 0,
        balloonActive: true
      },
      // SVO
      svo: {
        currentIndex: 0,
        responses: [],
        maxItems: 6
      },
      // RAVEN
      raven: {
        currentIndex: 0,
        score: 0,
        maxItems: 3
      },
      // RME
      rme: {
        currentIndex: 0,
        score: 0,
        maxItems: 6
      }
    };

    // ------------------------------------------------------------
    //  MAT√âRIEL STIMULI ‚Äì sans emojis, formes neutres
    // ------------------------------------------------------------
    const SVO_ITEMS = [
      { scenario: "vous recevez 85 ‚Ç¨ / autre 85 ‚Ç¨   vs   vous 100 ‚Ç¨ / autre 50 ‚Ç¨", optA: [85,85], optB: [100,50], prosocialChoice: 0 },
      { scenario: "vous 85 ‚Ç¨ / autre 85 ‚Ç¨   vs   vous 95 ‚Ç¨ / autre 15 ‚Ç¨", optA: [85,85], optB: [95,15], prosocialChoice: 0 },
      { scenario: "vous 60 ‚Ç¨ / autre 50 ‚Ç¨   vs   vous 50 ‚Ç¨ / autre 100 ‚Ç¨", optA: [60,50], optB: [50,100], prosocialChoice: 1 },
      { scenario: "vous 75 ‚Ç¨ / autre 65 ‚Ç¨   vs   vous 90 ‚Ç¨ / autre 30 ‚Ç¨", optA: [75,65], optB: [90,30], prosocialChoice: 0 },
      { scenario: "vous 45 ‚Ç¨ / autre 80 ‚Ç¨   vs   vous 70 ‚Ç¨ / autre 70 ‚Ç¨", optA: [45,80], optB: [70,70], prosocialChoice: 1 },
      { scenario: "vous 100 ‚Ç¨ / autre 20 ‚Ç¨   vs   vous 85 ‚Ç¨ / autre 85 ‚Ç¨", optA: [100,20], optB: [85,85], prosocialChoice: 1 }
    ];

    const RAVEN_ITEMS = [
      { matrix: ['‚óº', '‚óª', '‚óº', '‚óª', '‚óº', '‚óª', '‚óº', '‚óª', '‚ùì'], options: ['‚óº', '‚óª', '‚ñ£', '‚óØ'], correct: '‚óº' },
      { matrix: ['1', '2', '3', '4', '5', '6', '7', '8', '‚ùì'], options: ['9', '10', '11', '12'], correct: '9' },
      { matrix: ['‚ñ≤', '‚ñ≥', '‚ñ≤', '‚ñ≥', '‚ñ≤', '‚ñ≥', '‚ñ≤', '‚ñ≥', '‚ùì'], options: ['‚ñ≤', '‚ñ≥', '‚óÄ', '‚ñ∂'], correct: '‚ñ≤' }
    ];

    const RME_ITEMS = [
      { stimulus: 'üëÅÔ∏è [ regard 1 ]', options: ['hostile', 'paniqu√©', 'amus√©', 'confiant'], correct: 'confiant' },
      { stimulus: 'üëÅÔ∏è [ regard 2 ]', options: ['sceptique', 'jaloux', 'affectueux', 'terrifi√©'], correct: 'sceptique' },
      { stimulus: 'üëÅÔ∏è [ regard 3 ]', options: ['d√©sireux', 'arrogant', 'g√™n√©', 'r√™veur'], correct: 'r√™veur' },
      { stimulus: 'üëÅÔ∏è [ regard 4 ]', options: ['irrit√©', 'triste', 'pr√©occup√©', 'amical'], correct: 'pr√©occup√©' },
      { stimulus: 'üëÅÔ∏è [ regard 5 ]', options: ['relax√©', 'mena√ßant', 'surpris', 'fier'], correct: 'relax√©' },
      { stimulus: 'üëÅÔ∏è [ regard 6 ]', options: ['dubitatif', 'en col√®re', 'reconnaissant', 'afflig√©'], correct: 'dubitatif' }
    ];

    // ------------------------------------------------------------
    //  RENDU SELON LA PHASE (s√©quentiel)
    // ------------------------------------------------------------
    function renderCurrentPhase() {
      const panel = document.getElementById('testPanel');
      let progressText = '';

      if (State.phase === 0) {
        progressText = 'phase 1/4 ¬∑ BART';
        panel.innerHTML = renderBART();
      } else if (State.phase === 1) {
        progressText = 'phase 2/4 ¬∑ SVO';
        panel.innerHTML = renderSVO();
      } else if (State.phase === 2) {
        progressText = 'phase 3/4 ¬∑ matrices Raven';
        panel.innerHTML = renderRAVEN();
      } else if (State.phase === 3) {
        progressText = 'phase 4/4 ¬∑ RME';
        panel.innerHTML = renderRME();
      } else if (State.phase === 4) {
        progressText = 'termin√©';
        panel.innerHTML = '<div style="text-align:center; padding:40px;"><h2 style="font-weight:400;">√©valuation termin√©e</h2><p style="margin-top:24px; color:#3f5e70;">vous pouvez consulter votre profil (lettres A‚ÄìD) ci-dessous.</p></div>';
      }

      document.getElementById('progressPhase').innerText = progressText;
      updateScoreUI();
      attachPhaseEvents();
    }

    // ---------- BART ----------
    function renderBART() {
      if (State.bart.balloonsDone >= 30) {
        State.phase = 1; // passage auto
        renderCurrentPhase();
        return '';
      }
      // initialiser essai si inactif
      if (!State.bart.balloonActive) {
        State.bart.balloonActive = true;
        State.bart.currentPumps = 0;
        State.bart.tempMoney = 0;
        State.bart.explosionPoint = Math.floor(Math.random() * 18) + 6; // 6-23
      }

      let size = 80 + State.bart.currentPumps * 3;
      let html = `<div class="balloon-container">
        <div class="test-title">Balloon Analogue Risk Task (BART)</div>
        <div>essai ${State.bart.balloonsDone + 1} / 30</div>
        <div class="balloon-svg">
          <svg width="${size}" height="${size+20}" viewBox="0 0 100 120">
            <circle cx="50" cy="50" r="${30 + State.bart.currentPumps*1.2}" fill="#c94f4f" stroke="#642424" stroke-width="1.5"/>
            <line x1="50" y1="65" x2="50" y2="95" stroke="#7c5e4a" stroke-width="2"/>
          </svg>
        </div>
        <div class="cash-indicator">gain temporaire : ${State.bart.tempMoney} points</div>
        <div class="btn-group">
          <button id="pumpBtn" class="btn">gonfler (+5)</button>
          <button id="collectBtn" class="btn btn-primary">collecter</button>
        </div>
      </div>`;
      return html;
    }

    // ---------- SVO ----------
    function renderSVO() {
      if (State.svo.currentIndex >= State.svo.maxItems) {
        State.phase = 2;
        renderCurrentPhase();
        return '';
      }
      let item = SVO_ITEMS[State.svo.currentIndex];
      return `<div>
        <div class="test-title">Social Value Orientation</div>
        <div>question ${State.svo.currentIndex+1} / ${State.svo.maxItems}</div>
        <div class="svo-scenario">${item.scenario}</div>
        <div class="btn-group">
          <button id="svoOptA" class="btn">option A</button>
          <button id="svoOptB" class="btn">option B</button>
        </div>
      </div>`;
    }

    // ---------- RAVEN ----------
    function renderRAVEN() {
      if (State.raven.currentIndex >= State.raven.maxItems) {
        State.phase = 3;
        renderCurrentPhase();
        return '';
      }
      let item = RAVEN_ITEMS[State.raven.currentIndex];
      let matrixHtml = '<div class="matrix-grid">';
      for (let i=0; i<9; i++) {
        matrixHtml += `<div class="matrix-cell">${item.matrix[i]}</div>`;
      }
      matrixHtml += '</div><div class="raven-choices">';
      item.options.forEach((opt, idx) => {
        matrixHtml += `<div class="choice-cell" data-choice="${opt}">${opt}</div>`;
      });
      matrixHtml += '</div>';
      return `<div><div class="test-title">Matrices de Raven</div>${matrixHtml}</div>`;
    }

    // ---------- RME ----------
    function renderRME() {
      if (State.rme.currentIndex >= State.rme.maxItems) {
        State.phase = 4;
        renderCurrentPhase();
        return '';
      }
      let eye = RME_ITEMS[State.rme.currentIndex];
      let optionsHtml = '<div class="emotion-grid">';
      eye.options.forEach(opt => {
        optionsHtml += `<div class="emotion-item" data-emotion="${opt}">${opt}</div>`;
      });
      optionsHtml += '</div>';
      return `<div>
        <div class="test-title">Reading the Mind in the Eyes</div>
        <div>stimulus ${State.rme.currentIndex+1} / ${State.rme.maxItems}</div>
        <div class="eyes-stimulus">${eye.stimulus}</div>
        ${optionsHtml}
      </div>`;
    }

    // ------------------------------------------------------------
    //  ATTACH DES √âV√àNEMENTS SELON PHASE
    // ------------------------------------------------------------
    function attachPhaseEvents() {
      if (State.phase === 0) attachBART();
      else if (State.phase === 1) attachSVO();
      else if (State.phase === 2) attachRAVEN();
      else if (State.phase === 3) attachRME();
    }

    function attachBART() {
      const pump = document.getElementById('pumpBtn');
      const collect = document.getElementById('collectBtn');
      if (pump) pump.onclick = () => {
        if (!State.bart.balloonActive || State.bart.balloonsDone>=30) return;
        State.bart.currentPumps++;
        State.bart.tempMoney += 5;
        if (State.bart.currentPumps >= State.bart.explosionPoint) {
          // explosion
          State.bart.tempMoney = 0;
          State.bart.balloonActive = false;
          State.bart.balloonsDone++;
          renderCurrentPhase();
        } else {
          renderCurrentPhase();
        }
      };
      if (collect) collect.onclick = () => {
        if (State.bart.balloonActive && State.bart.balloonsDone<30) {
          State.bart.pumpsHistory.push(State.bart.currentPumps);
          State.bart.balloonActive = false;
          State.bart.balloonsDone++;
          if (State.bart.balloonsDone >= 30) State.phase = 1;
          renderCurrentPhase();
        }
      };
    }

    function attachSVO() {
      const optA = document.getElementById('svoOptA');
      const optB = document.getElementById('svoOptB');
      if (optA) optA.onclick = () => { recordSVO(0); };
      if (optB) optB.onclick = () => { recordSVO(1); };
    }

    function recordSVO(choice) {
      State.svo.responses.push(choice);
      State.svo.currentIndex++;
      if (State.svo.currentIndex >= State.svo.maxItems) State.phase = 2;
      renderCurrentPhase();
      updateScoreUI();
    }

    function attachRAVEN() {
      document.querySelectorAll('.choice-cell').forEach(el => {
        el.onclick = (e) => {
          let chosen = e.currentTarget.dataset.choice;
          let correct = RAVEN_ITEMS[State.raven.currentIndex].correct;
          if (chosen === correct) State.raven.score++;
          State.raven.currentIndex++;
          if (State.raven.currentIndex >= State.raven.maxItems) State.phase = 3;
          renderCurrentPhase();
          updateScoreUI();
        };
      });
    }

    function attachRME() {
      document.querySelectorAll('.emotion-item').forEach(el => {
        el.onclick = (e) => {
          let chosen = e.currentTarget.dataset.emotion;
          let correct = RME_ITEMS[State.rme.currentIndex].correct;
          if (chosen === correct) State.rme.score++;
          State.rme.currentIndex++;
          if (State.rme.currentIndex >= State.rme.maxItems) State.phase = 4;
          renderCurrentPhase();
          updateScoreUI();
        };
      });
    }

    // ------------------------------------------------------------
    //  CALCUL DES SCORES POUR AFFICHAGE (lettres)
    // ------------------------------------------------------------
    function computeScoreA() {
      if (State.bart.pumpsHistory.length === 0) return 0;
      let sum = State.bart.pumpsHistory.reduce((a,b)=>a+b,0);
      return Math.round((sum / State.bart.pumpsHistory.length) * 6); // √©chelle
    }

    function computeScoreB() {
      let prosocialCount = 0;
      State.svo.responses.forEach((resp, idx) => {
        if (SVO_ITEMS[idx] && resp === SVO_ITEMS[idx].prosocialChoice) prosocialCount++;
      });
      return prosocialCount * 28; // √©talement
    }

    function computeScoreC() {
      return State.raven.score * 55;
    }

    function computeScoreD() {
      return State.rme.score * 28;
    }

    function updateScoreUI() {
      document.getElementById('scoreA').innerText = computeScoreA();
      document.getElementById('scoreB').innerText = computeScoreB();
      document.getElementById('scoreC').innerText = computeScoreC();
      document.getElementById('scoreD').innerText = computeScoreD();
    }

    // ------------------------------------------------------------
    //  ADMIN : CODE 1983
    // ------------------------------------------------------------
    function unlockInterpretation() {
      let code = document.getElementById('secretCode').value;
      if (code === '1983') {
        let interp = `INTERPR√âTATION DES CAT√âGORIES (CHERCHEUR) :

A (score ${computeScoreA()}) : BART ‚Äì moyenne pompes ajust√©e. Plus le score est √©lev√©, plus la prise de risque est forte.

B (score ${computeScoreB()}) : SVO ‚Äì score de prosocialit√©. >120 = prosocial ; 60-120 = individualiste ; <60 = comp√©titif.

C (score ${computeScoreC()}) : Raven ‚Äì raisonnement logique. Sur 165 max, capacit√© d'abstraction et d'induction.

D (score ${computeScoreD()}) : RME ‚Äì th√©orie de l'esprit. Sur 168 max, sensibilit√© aux √©tats mentaux d'autrui.`;
        document.getElementById('interpText').innerText = interp;
        document.getElementById('adminInterpretation').classList.remove('hidden');
      } else {
        alert('code erron√©');
      }
    }

    // r√©initialisation
    function resetSession() {
      window.location.reload();
    }

    // ------------------------------------------------------------
    //  INIT
    // ------------------------------------------------------------
    window.onload = function() {
      // initialisation BART
      State.bart.balloonActive = true;
      State.bart.balloonsDone = 0;
      State.bart.currentPumps = 0;
      State.bart.tempMoney = 0;
      State.bart.explosionPoint = Math.floor(Math.random() * 18) + 6;

      renderCurrentPhase();

      document.getElementById('unlockBtn').addEventListener('click', unlockInterpretation);
      document.getElementById('resetBtn').addEventListener('click', resetSession);
    };
  </script>
</body>
</html>
